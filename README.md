yadr
====

Yet Another Delta Robot



### Механика.

Рука сервомашинки (плечо - те деталь которая крепится прямо на вал сервы)
вырезана из поликарбоната толщиной 5мм (по ширине вала) и плотно насаживается
с предварительным нагреванием, например феном.
Люфта в месте крепления нет, но само плечо гнётся при боковых нагрузках.
Возможно, этого можно избежать используя более толстый лист поликарбоната.

Тяга дельты - карбоновая трубка с вклеенными с двух сторон болтами 3мм резбой
наружу. На болты накручиваются шаровые соединения (ball-joint)
повсеместно используемые в авиа и авто-моделировании.
[Вроде таких](http://www.hobbyking.com/hobbyking/store/__13099__m3_alloy_ball_joint_5pcs_bag_.html)

Остальные детали печатаются из пластика на 3D принтере.
Модели лежат в каталоге scad/
Для проектирования и экспорта моделей в STL формат (для печати) используется
[OpenSCAD](http://www.openscad.org/documentation.html)


### Управление.

Контроллер - arduino UNO.

Пока не используются датчики в контроллер никакая логика не выносится вообще.
Рассчёты координат и сглаживание реализуется в управляющей программе на
стороне ПК.

Контроллер хранит состояние и меняет соответствующий сигнал шима после
получение команды.


### Протокол.

Протокол текстовый, ASCII кодировка.

Каждая комманда состоит из одного десятиричного числа и следующего за ним
управляющего символа. Остальные символы, кроме десятичных цифр и описанныех управляющих
символов - игнорируются и являются разделителями комманд.
Т.е. внутри команды не может быть игнорируемых символов.

Символы:
* 'a', 'b', 'c' - угол одной из серв.
* 'f', 'g', 'h' - заполнение шим одной из серв соответственно, в микросекундах.

Например:
- "120a95b  \n 60c\n" - установить угол первой сервы - 120, второй - 95, третьей - 60.
- "1350b" - установить заполнение шима второй сервы 1.35 миллисекунды.


### Управляющая программа на стороне ПК.

Сглаживание необходимо чтобы снизить нагрузки на серву и крепления в начале
и в конце движения, а также для чтобы не допускать колебаний движущихся частей
после остановки.

Алгоритм сглаживания углов:

1. Расстояние между точками S (углами) делится на 2, половина - r.
Начальное положение a, текущее положение x, положение назначения z.
2. Устанавливается определённый шаг по времени dt, например 50 мс.
3. Устанавливается значения первого шага изменения угла v - например 1 миллисекунда (для заполнения шим).
4. Последующие шаги увеличиваются каждую итерацию прибавлением константы k.
5. Когда очередной шаг становится больше половины расстояния между текущей точкой и
серединой расстояния - скорость изменения фиксируется для того чтобы сохранить симметрию
при торможении. v = (a+r - x) / 2.
6. Выполняется 4 шага с фиксированной скорость.
7. Дале шаги уменьшаются каждую итерацию на k, пока значение x не достигнет z.

Псевдокод:
```
a, S, dt, k
z = A+S, r = S/2
v = 1
while v < (a+r - x)/2:
  x = x + v
  v = v + k
  wait(dt)
v = (a+r - x)/2
repeat 4 times:
  x = x + v
  wait(dt)
while x < z:
  x = x + v
  if v > 1:
    v = v - k
  wait(dt)
```

Итого ускорение не будет превышать значение k/dt.
А сами эти два числа являются параметрами сглаживания.

Сглаживание изменения углов независимо:
1. По координатам назначения вычисляются углы.
2. Производится сглаживание изменения углов.

Сглаживание координат по вектору перемещения аффектора:
1. Вычисляется вектор конечного перемещения в заданные координаты.
2. В алгоритме сглаживания скорость изменения угла заменяется на вектор перемещения.
3. Каждую итерацию углы рассчитываются из нового значения координат.

P.S. Как же весело и забавно изобретать велосипед!


### Использованные ресурсы.

[Подробный разбор кинематики дельта-робота с кодом рассчёта углов и координат на Си](http://forums.trossenrobotics.com/tutorials/introduction-129/delta-robot-kinematics-3276/)

[Управление сервой](http://www.avislab.com/blog/serva/)



